# 7. reactë¥¼ s3ì— ì˜¬ë¦¬ê¸°

# **1. S3 ë²„í‚· ìƒì„±**

- AWS ì½˜ì†” â†’ S3 â†’ "ë²„í‚· ë§Œë“¤ê¸°" í´ë¦­
- ë²„í‚· ì´ë¦„ ì„¤ì • (ì˜ˆ: `my-react-app`)
- **í¼ë¸”ë¦­ ì•¡ì„¸ìŠ¤ ì°¨ë‹¨ í•´ì œ** (ì •ì  ì›¹ í˜¸ìŠ¤íŒ…ì„ ìœ„í•´ í•„ìš”)
- "ìƒì„±" í´ë¦­

![image](https://github.com/user-attachments/assets/e8b3c1af-3bf5-407a-8acf-0a47950e7332)

![image 1](https://github.com/user-attachments/assets/57a55579-2d84-4033-bdc1-f359813e62d6)

## **2. ì •ì  ì›¹ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ… í™œì„±í™”**

- S3 ë²„í‚· ì„ íƒ â†’ "ì†ì„±" íƒ­ â†’ "ì •ì  ì›¹ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ…" í™œì„±í™”
- ì¸ë±ìŠ¤ ë¬¸ì„œ: `index.html`
- ì˜¤ë¥˜ ë¬¸ì„œ: `index.html` (Reactì˜ SPA ë¼ìš°íŒ… ë¬¸ì œ í•´ê²°)

![image 2](https://github.com/user-attachments/assets/e362a6c3-1bf3-4d91-a2f5-5a0db88649d9)

![image 3](https://github.com/user-attachments/assets/42c9abd0-bd39-47a9-93db-909643a9ceb8)

## 3. Secrets ì¶”ê°€í•˜ê¸°

### âœ… 1. IAM ì‚¬ìš©ì ìƒì„±

1. **AWS ì½˜ì†” ì ‘ì†** â†’ [IAM ëŒ€ì‹œë³´ë“œ](https://console.aws.amazon.com/iam/home)
2. ì™¼ìª½ ë©”ë‰´ì—ì„œ **ì‚¬ìš©ì** > **ì‚¬ìš©ì ì¶”ê°€**
3. ì‚¬ìš©ì ì´ë¦„: ì˜ˆ) `github-actions-ci`
4. **ì•¡ì„¸ìŠ¤ ìœ í˜•**: âœ… í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì•¡ì„¸ìŠ¤ë§Œ ì²´í¬
5. ë‹¤ìŒ: ê¶Œí•œ ì„¤ì •

---

### âœ… 2. ê¶Œí•œ ì„¤ì •

### ğŸ”¹ ë°©ë²• A: ê¸°ì¡´ ì •ì±… ì‚¬ìš© (ê°„í¸)

- **AmazonS3FullAccess** (React ì •ì  íŒŒì¼ì„ S3ì— ì—…ë¡œë“œí•  ê²½ìš°)
- **AWSElasticBeanstalkFullAccess** (ìŠ¤í”„ë§ë¶€íŠ¸ EB ë°°í¬ë„ í•  ê²½ìš°)

---

### âœ… 3. ì•¡ì„¸ìŠ¤ í‚¤ ë°œê¸‰

![image 4](https://github.com/user-attachments/assets/a1d6415d-b235-4d36-8e2a-8714914a54ef)

ì‚¬ìš©ì ìƒì„± í›„, **`ì•¡ì„¸ìŠ¤ í‚¤ ID`** ì™€ **`ë¹„ë°€ ì•¡ì„¸ìŠ¤ í‚¤`** ë¥¼ í™•ì¸í•˜ì„¸ìš”.

> ì£¼ì˜: ì´ í‚¤ëŠ” í•œ ë²ˆë§Œ í‘œì‹œë˜ë‹ˆ GitHubì— ë°”ë¡œ ë“±ë¡í•˜ì„¸ìš”!
> 

---

### âœ… 4. GitHubì— ë¹„ë°€í‚¤ ë“±ë¡

GitHub ë¦¬í¬ì§€í† ë¦¬ â†’ `Settings` â†’ `Secrets and variables` â†’ `Actions` â†’ `New repository secret` í´ë¦­í•´ì„œ ë‹¤ìŒ ì¶”ê°€:

| ì´ë¦„ | ê°’ |
| --- | --- |
| `AWS_ACCESS_KEY_ID` | (ë³µì‚¬í•œ í‚¤ ID) |
| `AWS_SECRET_ACCESS_KEY` | (ë³µì‚¬í•œ ì‹œí¬ë¦¿ í‚¤) |

![image 5](https://github.com/user-attachments/assets/ed6fab7d-5e59-4d11-91b5-2c4564167e99)

---

### ğŸ”„ ê·¸ë‹¤ìŒ

ì´ì œ `deploy.yml`ì—ì„œ ì•„ë˜ ì„¤ì •ì„ ì¶”ê°€í•´ì„œ ì‚¬ìš©:

### deploy.yml

```yaml
name: ë°°í¬

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest # ì‘ì—…ì´ ì‹¤í–‰ë  í™˜ê²½
    steps:
    - name: ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v3
    - name: Node.js ì„¤ì •
      uses: actions/setup-node@v3
      with:
        node-version: 18

    - name: í”„ë¡œì íŠ¸ ì˜ì¡´ì„± ì„¤ì¹˜
      run: npm install # ë˜ëŠ” yarn install

    - name: React ë¹Œë“œ
      run: npm run build # ë˜ëŠ” yarn build

    - name: AWS CLI ì„¤ì •
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ap-northeast-2 # ì„œìš¸ ë¦¬ì „ (í•„ìš”ì‹œ ë³€ê²½)

    - name: S3ì— ë¹Œë“œ íŒŒì¼ ì—…ë¡œë“œ
      run: aws s3 sync build/ s3://${{ secrets.AWS_S3_BUCKET_NAME }}
```

## 4. í™•ì¸í•˜ê¸°

### 1. S3 ì •ì  ì›¹ ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ… ì„¤ì • í™•ì¸

1. AWS ì½˜ì†” > S3 > í•´ë‹¹ ë²„í‚· í´ë¦­
2. **[ì†ì„±] > [ì •ì  ì›¹ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ…]** ì„¹ì…˜ í™•ì¸
    - `ì •ì  ì›¹ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ…`ì´ **í™œì„±í™”ë¨**
    - **ê¸°ë³¸ ë¬¸ì„œ**: `index.html`
    - (ì„ íƒ) ì˜¤ë¥˜ ë¬¸ì„œ: `index.html` ë˜ëŠ” `404.html`

![image 6](https://github.com/user-attachments/assets/6378dd03-3525-4f45-a5ca-cdb1ad746071)

### 2. ë¬¸ì œ í™•ì¸

![image 7](https://github.com/user-attachments/assets/0f539b3a-b332-430f-902c-01ff8ce743a5)

### 3. ë²„í‚·ì •ì±… ì¶”ê°€í•˜ê¸°

![image 8](https://github.com/user-attachments/assets/75628af4-13de-4102-8325-779551efc0ee)

```yaml
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowPublicReadAccess",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::zzzmini-react-app/*"
    }
  ]
}

```

ì‹¤í–‰ ê²°ê³¼

### 4. Spring Cors ìˆ˜ì •

```java
package my.backend.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class CorsConfig {
    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping("/api/**")
//                        .allowedOrigins("http://3.37.155.248") // React ì„œë²„ ì£¼ì†Œ
                        .allowedOrigins("http://zzzmini-react-app.s3-website.ap-northeast-2.amazonaws.com") // S3 URL
                        .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                        .allowCredentials(true);
            }
        };
    }
}
```
